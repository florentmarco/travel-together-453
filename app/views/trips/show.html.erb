<div class="container">
  <h1>Trip to <%= @trip.location %>  </h1>
  <p> <%= @trip.name %> </p>
  <%= @trip.start_date %> <%= @trip.end_date %>

  <%= link_to 'Edit', edit_trip_path(@trip), class: "btn btn-primary" %>
  <%= link_to 'Back', trips_path, class: "btn btn-primary" %>
  <div class="dropdown" data-controller="item-form" data-item-form-url= "<%= new_trip_item_path(@trip) %>" >
    <span data-target="item-form.category" type="text"></span>
    <button class="btn btn-secondary dropdown-toggle" type="button" data-action="click->item_form#serve" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Add item
    </button>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      <p data-action="click->item-form#serve" data-item="Flight" class="dropdown-item" >Flight</p>
      <p data-action="click->item-form#serve" data-item="Accommodation" class="dropdown-item" >Accommodation</p>
      <p data-action="click->item-form#serve" data-item="Activity" class="dropdown-item" >Activity</p>
    </div>
    <span data-target="item-form.form">
    </span>
  </div>

  <hr>
  <%= link_to "Re-generate invite link", regenerate_invite_link_path(@trip), method: :patch %>
  <p> Invite link: <%= Rails.application.routes.url_helpers.trip_url(@trip, host: request.host) %>?token=<%= @trip.invite_token %> </p>
  <form action="/email">
    <label for="email">Send to:  </label>
    <input type="text" name="email" placeholder="Enter an email address"><br>
    <input type="hidden" name="token" value="<%= Rails.application.routes.url_helpers.trip_url(@trip, host: request.host) %>?token=<%= @trip.invite_token %>">
    <input type="hidden" name="subject" value="Your friend <%= @trip.user.name %> has invited you to the <%= @trip.location %> trip">
    <input type="hidden" name="trip_id" value="<%= @trip.id %>">
    <input type="hidden" name="trip_name" value="<%= @trip.location %>">
    <input type="hidden" name="trip_sdate" value="<%= @trip.start_date %>">
    <input type="hidden" name="trip_edate" value="<%= @trip.end_date %>">
    <input type="hidden" name="trip_user" value="<%= @trip.user.name %>">
    <input type="submit" value="Send" class="btn btn-primary">
    <input type="submit" value="Cancel" class="btn btn-danger">
  </form>

  <hr>

  <div data-controller="item-status" data-item-status-url="<%= trip_items_path(@trip) %>">
    <div class="d-flex">
      <ul class="list-inline tabs-underlined">
        <li>
          <%= link_to "Flight", "#", id: "flightTab", class: "tab-underlined active", "data-action": 'click->item-status#flight' %>
        </li>
        <li>
          <%= link_to "Accommodation", "#", id: "accommodationTab", class: "tab-underlined active", "data-action": 'click->item-status#accommodation' %>
        </li>
        <li>
          <%= link_to "Activity", "#", id: "activityTab", class: "tab-underlined active", "data-action": 'click->item-status#activity' %>
        </li>
      </ul>

      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Filter
        </button>
        <div class="dropdown-menu">
          <div class="form-check ml-3" >
            <input id= "pendingTab" type="checkbox" class="form-check-input" id="dropdownCheck2" checked="true" data-action ='change->item-status#pending'>
            <label class="form-check-label" for="dropdownCheck2">
              Pending
            </label>
          </div>
          <div class="form-check ml-3" >
            <input id= "approvedTab" type="checkbox" class="form-check-input" id="dropdownCheck2" checked="true" data-action ='change->item-status#approved'>
            <label class="form-check-label" for="dropdownCheck2">
              Approved
            </label>
          </div>
          <div class="form-check ml-3" >
            <input id= "bookedTab" type="checkbox" class="form-check-input" id="dropdownCheck2" checked="true" data-action ='change->item-status#booked'>
            <label class="form-check-label" for="dropdownCheck2">
              Booked
            </label>
          </div>
        </div>
      </div>
    </div>

    <hr>

    <div data-target='item-status.items'>
      <%= render partial: 'items/item', collection: @trip.items %>
    </div>


    <div class="dropdown" data-controller="item-form" data-item-form-url= "<%= new_trip_item_path(@trip) %>" >
      <span data-target="item-form.category" type="text"></span>
      <button class="btn btn-secondary dropdown-toggle" type="button" data-action="click->item_form#serve" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Add Plan
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <p data-action="click->item-form#serve" data-item="flight" class="dropdown-item" >Flight</p>
        <p data-action="click->item-form#serve" data-item="accomodation" class="dropdown-item" >Accomodation</p>
        <p data-action="click->item-form#serve" data-item="activity" class="dropdown-item" >Activity</p>
      </div>
      <span data-target="item-form.form">
      </span>
    </div>
  </div>

  <hr>

  <h3>Messages </h3>
  <div id="messages" data-trip-id="<%= @trip.id %>">
    <% @trip.messages.each do |message| %>
      <%= render 'messages/message', message: message %>
    <% end %>
  </div>

  <%= simple_form_for [ @trip, @message ], remote: true do |f| %>
    <%= f.input :content, label: false, placeholder: "Message ##{@trip.name}" %>
    <%= f.submit %>
  <% end %>

<!-- closing div for container -->
</div>
